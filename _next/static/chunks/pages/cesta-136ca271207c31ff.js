(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[240],{9264:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cesta",function(){return a(2631)}])},2249:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var r=a(5893),n=a(645),s=a.n(n);function c(e){let{status:t,message:a,hidden:n,setHidden:c}=e,i="",o="";return"success"===t?(i="\xa1\xc9xito!",o=s().success):"warning"===t&&(i="\xa1Atenci\xf3n!",o=s().warning),(0,r.jsxs)("div",{className:"".concat(s().container," ").concat(o)+" "+(n?s().hidden:""),children:[(0,r.jsx)("span",{className:s().closeButton,onClick:()=>c(!0),children:"\xd7"}),(0,r.jsx)("strong",{children:i})," ",a]})}a(7294)},2631:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var r=a(5893),n=a(570),s=a.n(n),c=a(338),i=a.n(c),o=a(7294);let l=e=>{let{cookie:t,custDetails:a,setCustDetails:n,cardDetails:c,setCardDetails:l,submitPayment:d,errorMessage:u,errorHidden:m}=e,[p,_]=(0,o.useState)(!1),h=e=>{_(!0),e.preventDefault()},g=(e,t)=>e.toString().substring(0,t);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("form",{onSubmit:h,className:s().form,children:[(0,r.jsx)("h1",{children:"Realizar pedido"}),(0,r.jsxs)("div",{className:"".concat(s().container)+(p?" ".concat(i().hidden):""),children:[(0,r.jsx)("input",{className:"".concat(s().input," ").concat(s().gridName),type:"text",name:"name",value:a.name,onChange:e=>n({...a,name:e.target.value}),placeholder:"Nombre",required:!0}),(0,r.jsx)("input",{className:"".concat(s().input," ").concat(s().gridLastNames),type:"text",name:"lastname",value:a.lastname,onChange:e=>n({...a,lastname:e.target.value}),placeholder:"Apellido(s)",required:!0}),(0,r.jsx)("input",{className:"".concat(s().input," ").concat(s().gridStreet),type:"text",name:"street",value:a.street,onChange:e=>n({...a,street:e.target.value}),placeholder:"Calle y n\xfamero",required:!0}),(0,r.jsx)("input",{className:"".concat(s().input," ").concat(s().gridPostal),type:"text",name:"postal",value:a.postal,onChange:e=>n({...a,postal:e.target.value}),placeholder:"C\xf3digo Postal",required:!0}),(0,r.jsx)("input",{className:"".concat(s().input," ").concat(s().gridCity),type:"text",name:"city",value:a.city,onChange:e=>n({...a,city:e.target.value}),placeholder:"Ciudad",required:!0}),(0,r.jsx)("input",{className:"".concat(s().input," ").concat(s().gridRegion),type:"text",name:"region",value:a.region,onChange:e=>n({...a,region:e.target.value}),placeholder:"Pa\xeds/Regi\xf3n",required:!0}),(0,r.jsx)("input",{className:"".concat(s().input," ").concat(s().gridEmail),type:"text",name:"email",value:a.email,onChange:e=>n({...a,email:e.target.value}),placeholder:"E-mail",required:!0}),(0,r.jsx)("input",{className:"".concat(s().input," ").concat(s().gridPhone),type:"text",name:"phone",value:a.phone,onChange:e=>n({...a,phone:e.target.value}),placeholder:"N\xfamero de tel\xe9fono",required:!0}),(0,r.jsx)("input",{className:"".concat(s().button," ").concat(s().gridButton),type:"submit",value:"Continuar"})]})]}),(0,r.jsxs)("div",{className:"".concat(s().detailsContainer)+(p?"":" ".concat(i().hidden)),onClick:()=>_(!1),children:[(0,r.jsx)("button",{className:s().editButton,type:"button",children:"Editar"}),(0,r.jsxs)("p",{children:[a.name," ",a.lastname]}),(0,r.jsx)("p",{children:a.street}),(0,r.jsxs)("p",{children:[a.city," ",a.postal," ",a.region]}),(0,r.jsx)("p",{children:a.email}),(0,r.jsx)("p",{children:a.phone})]}),(0,r.jsxs)("form",{onSubmit:d,className:"".concat(s().form)+(p?"":" ".concat(i().hidden)),children:[(0,r.jsxs)("div",{className:s().cardField,children:[(0,r.jsx)("label",{htmlFor:"cardNumber",children:"N\xfamero tarjeta"}),(0,r.jsx)("div",{className:s().cardRow,children:(0,r.jsx)("input",{className:"".concat(s().input," ").concat(s().cardNumber),type:"number",name:"cardNumber",value:g(c.number,16),onChange:e=>l({...c,number:isNaN(e.target.valueAsNumber)?"":e.target.valueAsNumber}),placeholder:"N\xfamero tarjeta",required:!0})})]}),(0,r.jsxs)("div",{className:s().cardField,children:[(0,r.jsx)("label",{children:"Caducidad"}),(0,r.jsxs)("div",{className:s().cardRow,children:[(0,r.jsx)("label",{htmlFor:"month",children:"Mes"}),(0,r.jsx)("input",{className:"".concat(s().input," ").concat(s().date),type:"number",name:"month",value:g(c.month,2),onChange:e=>l({...c,month:isNaN(e.target.valueAsNumber)?"":e.target.valueAsNumber}),placeholder:"MM",required:!0}),(0,r.jsx)("label",{htmlFor:"year",children:"A\xf1o"}),(0,r.jsx)("input",{className:"".concat(s().input," ").concat(s().date),type:"number",name:"year",value:g(c.year,2),onChange:e=>l({...c,year:isNaN(e.target.valueAsNumber)?"":e.target.valueAsNumber}),placeholder:"AA",required:!0})]})]}),(0,r.jsxs)("div",{className:s().cardField,children:[(0,r.jsx)("label",{htmlFor:"CVC",children:"C\xf3d. Seguridad"}),(0,r.jsx)("div",{className:s().cardRow,children:(0,r.jsx)("input",{className:"".concat(s().input," ").concat(s().cvc),type:"number",name:"CVC",value:g(c.code,3),onChange:e=>l({...c,code:isNaN(e.target.valueAsNumber)?"":e.target.valueAsNumber}),placeholder:"CVC",required:!0})})]}),(0,r.jsx)("input",{className:"".concat(s().button),type:"submit",value:"Enviar pago"})]})]})},d=e=>{let{cookieCart:t,setCookieCart:a,total:n,setTotal:s}=e,[c,l]=(0,o.useState)([]),[d,u]=(0,o.useState)(0),[m,p]=(0,o.useState)(0);(0,o.useEffect)(()=>l(e=>void 0===t.cart?[]:t.cart),[t.cart]),(0,o.useEffect)(()=>{let e=0;c.length>0&&(e=c.reduce((e,t)=>e+t.price,0)),p(t=>e),u(e=>1),s(e=>m+d)},[c,s,m,d]);let _=e=>{console.log(e);let r=t.cart;r.splice(e,1),a("cart",r,{path:"/",maxAge:3600,sameSite:!0})},h=new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{children:"En tu cesta"}),c.length>0?(0,r.jsxs)("ul",{className:"".concat(i().productList," ").concat(i().topMargin),children:[c.map((e,t)=>(0,r.jsxs)("li",{className:"".concat(i().product," ").concat(i().productRow),onClick:()=>_(t),children:[(0,r.jsx)("span",{children:(0,r.jsx)("button",{className:i().productButton,children:e.name})}),(0,r.jsx)("span",{children:h.format(e.price)})]},t.toString())),(0,r.jsxs)("li",{className:"".concat(i().productRow," ").concat(i().topMargin),children:[(0,r.jsx)("span",{children:"Subtotal"}),(0,r.jsx)("span",{children:h.format(m)})]},"subtotal"),(0,r.jsxs)("li",{className:i().productRow,children:[(0,r.jsx)("span",{children:"Gastos de env\xedo estimados"}),(0,r.jsx)("span",{children:h.format(d)})]},"shipping"),(0,r.jsxs)("li",{className:"".concat(i().productRow," ").concat(i().bold),children:[(0,r.jsx)("span",{children:"Total"}),(0,r.jsx)("span",{children:h.format(n)})]},"total")]}):(0,r.jsx)("p",{className:i().topMargin,children:"Tu cesta est\xe1 vacia"})]})};var u=a(2249);let m=e=>{let{cookie:t,cookieCart:a,setCookieCart:n}=e,[s,c]=(0,o.useState)({email:"",name:"",lastname:"",street:"",postal:"",city:"",region:"",phone:""}),[m,p]=(0,o.useState)({number:"",month:"",year:"",code:""}),[_,h]=(0,o.useState)(0),[g,x]=(0,o.useState)(!0),[C,j]=(0,o.useState)(!1),[N,v]=(0,o.useState)(""),[f,y]=(0,o.useState)(!1),[b,F]=(0,o.useState)(!0),[S,A]=(0,o.useState)(!1);(0,o.useEffect)(()=>x(e=>!Array.isArray(a.cart)||!a.cart.length),[a.cart]),(0,o.useEffect)(()=>j(e=>void 0!==t.user&&0!==Object.keys(t.user).length),[t.user]),(0,o.useEffect)(()=>{let e="";C||(e="Necesitas iniciar sesi\xf3n para comprar"),g&&(e="Tu cesta esta vac\xeda"),C&&!g?y(e=>!0):y(e=>!1),v(t=>e)},[g,t.authenticated,C,v]);let w=e=>{console.log("Submit payment"),!C||g?F(!1):E(),e.preventDefault()},R=()=>{n("cart",[],{path:"/",maxAge:3600,sameSite:!0})};async function E(){var e;let r=null===(e=t.user)||void 0===e?void 0:e.id,n=null==a?void 0:a.cart,s=new FormData;s.append("user",r),s.append("total",_),s.append("products",JSON.stringify(n)),console.log(s);try{await fetch("/api/createPayment.php",{method:"POST",body:s}).then(e=>e.json()).then(e=>{if(console.log(e),alert("ok"),200==e.paymentData.code){R();let t=e.redsys;document.getElementById("Ds_MerchantParameters").value=t.params,document.getElementById("Ds_Signature").value=t.signature,document.from.submit()}})}catch(e){alert("ERROR: Check console"),console.log("ERROR submitting payment:",e)}}return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.Z,{status:"warning",message:N,hidden:b,setHidden:F}),(0,r.jsxs)("div",{className:i().container,children:[(0,r.jsx)("div",{className:i().contentsContainer,children:(0,r.jsx)(d,{cookieCart:a,setCookieCart:n,total:_,setTotal:h})}),(0,r.jsx)("div",{className:i().formContainer,children:(0,r.jsx)(l,{cookie:t,custDetails:s,setCustDetails:c,cardDetails:m,setCardDetails:p,submitPayment:w,errorMessage:N,errorHidden:f})})]}),(0,r.jsxs)("form",{name:"from",action:"https://sis-t.redsys.es:25443/sis/realizarPago",method:"POST",id:"redsys-form",children:[(0,r.jsx)("input",{type:"hidden",id:"Ds_SignatureVersion",name:"Ds_SignatureVersion",value:"HMAC_SHA256_V1"}),(0,r.jsx)("input",{type:"hidden",name:"Ds_MerchantParameters",id:"Ds_MerchantParameters"}),(0,r.jsx)("input",{type:"hidden",name:"Ds_Signature",id:"Ds_Signature"})]})]})};var p=m},645:function(e){e.exports={container:"Alert_container__JZ6KE",success:"Alert_success__uY4Zs",warning:"Alert_warning__K19x1",closeButton:"Alert_closeButton__tLxe_",hidden:"Alert_hidden__5MRcS"}},338:function(e){e.exports={topMargin:"Cart_topMargin__sIcaI",bold:"Cart_bold__WlFCB",container:"Cart_container__v66s_",contentsContainer:"Cart_contentsContainer__JrABM",formContainer:"Cart_formContainer___39pd",hidden:"Cart_hidden__9v3_a",productList:"Cart_productList__FGtRh",productRow:"Cart_productRow__yiosr",product:"Cart_product__Xv1yD"}},570:function(e){e.exports={form:"CartForm_form__OfijY",input:"CartForm_input__ySOvj",button:"CartForm_button__FJvZT",editButton:"CartForm_editButton__4Cy5r",gridName:"CartForm_gridName__uNoQA",gridLastNames:"CartForm_gridLastNames__pTv5C",gridStreet:"CartForm_gridStreet__P8H2k",gridPostal:"CartForm_gridPostal__MW_FO",gridCity:"CartForm_gridCity__wqu2O",gridRegion:"CartForm_gridRegion__ubmU6",gridEmail:"CartForm_gridEmail__gYXpj",gridPhone:"CartForm_gridPhone__tzXXo",gridButton:"CartForm_gridButton__f_3CZ",container:"CartForm_container__q1BAk",payContainer:"CartForm_payContainer___Bf6g",detailsContainer:"CartForm_detailsContainer__ysXex",cardField:"CartForm_cardField__c9VYb",cardRow:"CartForm_cardRow__5QxZ4",date:"CartForm_date__xqv7Y",cvc:"CartForm_cvc__qB_sH",error:"CartForm_error__LixR7"}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=9264)}),_N_E=e.O()}]);