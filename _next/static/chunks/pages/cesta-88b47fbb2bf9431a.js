(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[240],{9264:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cesta",function(){return a(3205)}])},9156:function(e,t,a){"use strict";a.d(t,{Z:function(){return o}});var n=a(5893),r=a(3736),s=a.n(r);function o(e){let{status:t,message:a,hidden:r,setHidden:o,canExit:i=!0}=e,c="",l="";return"success"===t?(c="\xa1\xc9xito!",l=s().success):"warning"===t&&(c="\xa1Atenci\xf3n!",l=s().warning),(0,n.jsxs)("div",{className:"".concat(s().container," ").concat(l)+" "+(r?s().hidden:""),children:[i&&void(s().closeButton,()=>o(!0)),(0,n.jsx)("strong",{children:c})," ",a]})}a(7294)},3205:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var n=a(5893),r=a(9028),s=a.n(r),o=a(7294);let i=e=>{let{cookie:t,custDetails:a,setCustDetails:r,submitPayment:i}=e;return(0,o.useEffect)(()=>{if((null==t?void 0:t.authenticated)==="true"){let e=t.user,n={...a};Object.keys(n).forEach(t=>{t in e&&(n[t]=e[t])}),r(n)}},[t.authenticated,t.user]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("form",{onSubmit:i,className:s().form,children:[(0,n.jsx)("h1",{children:"Realizar pedido"}),(0,n.jsxs)("div",{className:"".concat(s().container),children:[(0,n.jsx)("input",{className:"".concat(s().input," ").concat(s().gridName),type:"text",name:"name",value:a.name,onChange:e=>r({...a,name:e.target.value}),placeholder:"Nombre",required:!0}),(0,n.jsx)("input",{className:"".concat(s().input," ").concat(s().gridLastNames),type:"text",name:"lastname",value:a.lastname,onChange:e=>r({...a,lastname:e.target.value}),placeholder:"Apellido(s)",required:!0}),(0,n.jsx)("input",{className:"".concat(s().input," ").concat(s().gridStreet),type:"text",name:"street",value:a.address,onChange:e=>r({...a,address:e.target.value}),placeholder:"Calle y n\xfamero",required:!0}),(0,n.jsx)("input",{className:"".concat(s().input," ").concat(s().gridPostal),type:"text",name:"postal",value:a.postal,onChange:e=>r({...a,postal:e.target.value}),placeholder:"C\xf3digo Postal",required:!0}),(0,n.jsx)("input",{className:"".concat(s().input," ").concat(s().gridCity),type:"text",name:"city",value:a.city,onChange:e=>r({...a,city:e.target.value}),placeholder:"Ciudad",required:!0}),(0,n.jsx)("input",{className:"".concat(s().input," ").concat(s().gridRegion),type:"text",name:"region",value:a.region,onChange:e=>r({...a,region:e.target.value}),placeholder:"Pa\xeds/Regi\xf3n",required:!0}),(0,n.jsx)("input",{className:"".concat(s().input," ").concat(s().gridEmail),type:"text",name:"email",value:a.email,onChange:e=>r({...a,email:e.target.value}),placeholder:"E-mail",required:!0}),(0,n.jsx)("input",{className:"".concat(s().input," ").concat(s().gridPhone),type:"text",name:"phone",value:a.phone,onChange:e=>r({...a,phone:e.target.value}),placeholder:"N\xfamero de tel\xe9fono",required:!0}),(0,n.jsx)("input",{className:"".concat(s().button," ").concat(s().gridButton),type:"submit",value:"Continuar al pago"})]})]})})};var c=a(4464),l=a.n(c),d=a(8193);let u=e=>{let{cookieCart:t,setCookieCart:a,total:r,setTotal:s}=e,[i,c]=(0,o.useState)([]),[u,m]=(0,o.useState)(0),[_,p]=(0,o.useState)(0);(0,o.useEffect)(()=>c(e=>void 0===t.cart?[]:t.cart),[t.cart]),(0,o.useEffect)(()=>{let e=0;i.length>0&&(e=i.reduce((e,t)=>e+t.price,0)),p(t=>e),m(e=>1),s(e=>_+u)},[i,s,_,u]);let g=e=>{console.log(e);let n=t.cart;n.splice(e,1),a("cart",n,{path:"/",maxAge:3600,sameSite:!0})},h=new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h2",{children:"En tu cesta"}),i.length>0?(0,n.jsxs)("ul",{className:"".concat(l().productList," ").concat(l().topMargin),children:[i.map((e,t)=>(0,n.jsxs)("li",{className:"".concat(l().product," ").concat(l().productRow),onClick:()=>g(t),children:[(0,n.jsx)(d.oHP,{}),(0,n.jsx)("span",{children:(0,n.jsx)("button",{className:l().productButton,children:e.name})}),(0,n.jsx)("span",{children:h.format(e.price)})]},t.toString())),(0,n.jsxs)("li",{className:"".concat(l().productRow," ").concat(l().topMargin),children:[(0,n.jsx)("span",{children:"Subtotal"}),(0,n.jsx)("span",{children:h.format(_)})]},"subtotal"),(0,n.jsxs)("li",{className:l().productRow,children:[(0,n.jsx)("span",{children:"Gastos de env\xedo estimados"}),(0,n.jsx)("span",{children:h.format(u)})]},"shipping"),(0,n.jsxs)("li",{className:"".concat(l().productRow," ").concat(l().bold),children:[(0,n.jsx)("span",{children:"Total"}),(0,n.jsx)("span",{children:h.format(r)})]},"total")]}):(0,n.jsx)("p",{className:l().topMargin,children:"Tu cesta est\xe1 vacia"})]})};var m=a(9156),_=a(9008),p=a.n(_);let g=e=>{let{cookie:t,cookieCart:a,setCookieCart:r}=e,[s,c]=(0,o.useState)({email:"",name:"",lastname:"",address:"",postal:"",city:"",region:"",phone:""}),[d,_]=(0,o.useState)(0),[g,h]=(0,o.useState)(!0),[x,C]=(0,o.useState)(!1),[f,j]=(0,o.useState)(""),[v,y]=(0,o.useState)(!0);(0,o.useEffect)(()=>h(e=>!Array.isArray(a.cart)||!a.cart.length),[a.cart]),(0,o.useEffect)(()=>C(e=>void 0!==t.user&&0!==Object.keys(t.user).length),[t.user]),(0,o.useEffect)(()=>{let e="";x||(e="Necesitas iniciar sesi\xf3n para comprar"),g&&(e="Tu cesta esta vac\xeda"),j(t=>e)},[g,t.authenticated,x,j]);let N=e=>{!x||g?y(!1):F(),e.preventDefault()};async function F(){var e;let n=null===(e=t.user)||void 0===e?void 0:e.id,r=null==a?void 0:a.cart,s=new FormData;s.append("user",n),s.append("total",d),s.append("products",JSON.stringify(r)),console.log(s);try{await fetch("/api/createPayment.php",{method:"POST",body:s}).then(e=>e.json()).then(e=>{if(console.log("Response data:",e),console.log("Response payment data:",e.paymentData),setTimeout(()=>{console.log("Redirigiendo a la plataforma de pago...")},"2000"),200==e.paymentData.code){let t=e.redsys;document.getElementById("Ds_MerchantParameters").value=t.params,document.getElementById("Ds_Signature").value=t.signature,document.from.submit()}})}catch(e){alert("ERROR: Check console"),console.log("ERROR submitting payment:",e)}}let S=(0,n.jsx)(p(),{children:(0,n.jsx)("title",{children:"Cesta"})}),R=(0,n.jsx)(n.Fragment,{});return R=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.Z,{status:"warning",message:f,hidden:v,setHidden:y}),(0,n.jsxs)("div",{className:l().container,children:[(0,n.jsx)("div",{className:l().contentsContainer,children:(0,n.jsx)(u,{cookieCart:a,setCookieCart:r,total:d,setTotal:_})}),(0,n.jsx)("div",{className:l().formContainer,children:(0,n.jsx)(i,{cookie:t,custDetails:s,setCustDetails:c,submitPayment:N})})]}),(0,n.jsxs)("form",{name:"from",action:"https://sis-t.redsys.es:25443/sis/realizarPago",method:"POST",id:"redsys-form",children:[(0,n.jsx)("input",{type:"hidden",id:"Ds_SignatureVersion",name:"Ds_SignatureVersion",value:"HMAC_SHA256_V1"}),(0,n.jsx)("input",{type:"hidden",name:"Ds_MerchantParameters",id:"Ds_MerchantParameters"}),(0,n.jsx)("input",{type:"hidden",name:"Ds_Signature",id:"Ds_Signature"})]})]}),(0,n.jsxs)(n.Fragment,{children:[S,R]})};var h=g},3736:function(e){e.exports={container:"Alert_container__JZ6KE",success:"Alert_success__uY4Zs",warning:"Alert_warning__K19x1",closeButton:"Alert_closeButton__tLxe_",hidden:"Alert_hidden__5MRcS"}},4464:function(e){e.exports={topMargin:"Cart_topMargin__sIcaI",bold:"Cart_bold__WlFCB",container:"Cart_container__v66s_",contentsContainer:"Cart_contentsContainer__JrABM",formContainer:"Cart_formContainer___39pd",hidden:"Cart_hidden__9v3_a",productList:"Cart_productList__FGtRh",productRow:"Cart_productRow__yiosr",product:"Cart_product__Xv1yD"}},9028:function(e){e.exports={form:"CartForm_form__OfijY",input:"CartForm_input__ySOvj",button:"CartForm_button__FJvZT",editButton:"CartForm_editButton__4Cy5r",gridName:"CartForm_gridName__uNoQA",gridLastNames:"CartForm_gridLastNames__pTv5C",gridStreet:"CartForm_gridStreet__P8H2k",gridPostal:"CartForm_gridPostal__MW_FO",gridCity:"CartForm_gridCity__wqu2O",gridRegion:"CartForm_gridRegion__ubmU6",gridEmail:"CartForm_gridEmail__gYXpj",gridPhone:"CartForm_gridPhone__tzXXo",gridButton:"CartForm_gridButton__f_3CZ",container:"CartForm_container__q1BAk",payContainer:"CartForm_payContainer___Bf6g",detailsContainer:"CartForm_detailsContainer__ysXex",cardField:"CartForm_cardField__c9VYb",cardRow:"CartForm_cardRow__5QxZ4",date:"CartForm_date__xqv7Y",cvc:"CartForm_cvc__qB_sH",error:"CartForm_error__LixR7"}},9008:function(e,t,a){e.exports=a(2636)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=9264)}),_N_E=e.O()}]);